(()=>{var i=class extends HTMLElement{static observedAttributes=["uri"];connectedCallback(){let e=this.getAttribute("uri");if(e?.endsWith("/")&&(e=e.slice(0,-1)),!e||!/^https?:\/\//.test(e)){console.error('webcrumbs-plugin requires an absolute uri like "https://your-subdomain.webcrumbs.cloud/"');return}this.renderFrom(e)}async renderFrom(e){if(window.webcrumbsRegistry||(window.webcrumbsRegistry={}),await this.addFonts(`${e}/style.css`),!window.webcrumbsRegistry[e]){await this.loadScript(`${e}/bundle.js`);let{Component:r,React:o,ReactDOM:c}=window.webcrumbs??{};if(!r||!o||!c)return;window.webcrumbsRegistry[e]={Component:r,React:o,ReactDOM:c}}let{Component:s,React:n,ReactDOM:t}=window.webcrumbsRegistry[e];this.renderShadow(s,n,t,e)}renderShadow(e,s,n,t){let r=this.attachShadow({mode:"open"}),o=document.createElement("link");o.rel="stylesheet",o.href=`${t}/style.css`,r.appendChild(o),n.createRoot(r).render(s.createElement(e))}async addFonts(e){window.__webcrumbsFontRegistry||(window.__webcrumbsFontRegistry=new Set);try{let s=await fetch(e).then(t=>t.text()),n=Array.from(s.matchAll(/@import\s+url\((.*?)\);/g)).map(t=>t[1].replace(/^['"]|['"]$/g,""));for(let t of n)if(!window.__webcrumbsFontRegistry.has(t)){let r=document.createElement("link");r.rel="stylesheet",r.href=t,document.head.appendChild(r),window.__webcrumbsFontRegistry.add(t)}}catch(s){console.warn("[webcrumbs-plugin] Failed to fetch style.css or parse font imports:",s)}}loadScript(e){return window.__webcrumbsScriptCache||(window.__webcrumbsScriptCache={}),window.__webcrumbsScriptCache[e]||(window.__webcrumbsScriptCache[e]=new Promise((s,n)=>{let t=document.querySelector(`script[src="${e}"]`);if(t){t.addEventListener("load",s),t.addEventListener("error",n);return}let r=document.createElement("script");r.src=e,r.onload=s,r.onerror=n,document.head.appendChild(r)})),window.__webcrumbsScriptCache[e]}};customElements.define("webcrumbs-plugin",i);})();
